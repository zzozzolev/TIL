## Default VPC
- 모든 새로운 AWS 계정들은 디폴트 VPC를 가진다.
- 새로운 EC2 인스턴스들은 서브셋이 특정되지 않으면 디폴트 VPC에 런치된다.
- 디폴트 VPC는 인터넷 연결성을 가지고 내부에 있는 모든 EC2 인스턴스들은 퍼블릭 IPv4 주소들을 가진다.
- 퍼블릭과 프라이빗 IPv4 DNS 이름들을 가진다.

## VPC in AWS - IPv4
- VPC = Virtual Private Cloud
- AWS 리전에 여러 개의 VPC들을 가질 수 있다. (최대 리전당 5개)
- VPC당 최대 CIDR는 5개. 각각의 CIDR 당
  - 최소 사이즈는 `/28` (16개의 IP 주소)
  - 최대 사이즈는 `/16` (65536개의 IP 주소)
- VPC CIDR는 다른 네트워크들과 중복되면 안 된다.
- AWS는 5개의 IP 주소들을 각각의 서브넷에서 예약해놨다.
- 이 다섯 개의 주소들은 사용할 수 없고 EC2 인스턴스에 할당될 수 없다.
- 만약, CIDR 블록이 `10.0.0.0/24`라면 예약된 IP 주소들은 다음과 같다.
  - `10.0.0.0`: 네트워크 어드레스
  - `10.0.0.1`: VPC 라우터
  - `10.0.0.2`: Amazon-provided DNS에 대한 맵핑
  - `10.0.0.3`: 미래 사용 용도
  - `10.0.0.255`: 네트워크 브로드 캐스트 주소. AWS는 VPC에서 브로드 캐스트를 지원하지 않으므로 해당 주소가 예약돼있다.

## IGW
- VPC에 있는 리소스들이 인터넷에 연결될 수 있도록 해준다.
- 수평적으로 확대, HA, 리던던트하다.
- VPC마다 별도로 생성돼야한다.
- 하나의 VPC는 하나의 IGW에만 어테치될 수 있고 반대도 마찬가지이다.
- IGW 자체는 인터넷 액세스를 허용하지 않는다.
- 라우트 테이블들이 수정돼야한다.
- IGW를 서브넷에 어테치하고 이를 위한 별도의 라우트 테이블을 설정해야한다.
- 라우트 테이블에 VPC 범위에 들어오지 않는 IP는 IGW로 보내야한다.

## NAT Gateway
- AWS-managed NAT
- 특징
  - 더 높은 bandwidth
  - 고가용성
  - 관리 필요없음
- 사용량과 bandwidth에 대해 시간당 지불해야한다.
- NATGW는 특정한 AZ에 생성되고 엘라스틱 IP를 사용한다.
- 같은 서브넷에 있는 EC2 인스턴스에 의해 사용될 수 없다. (다른 서브넷에 있는 것만)
- IGW를 필요로 한다. (private subnet -> NATGW -> IGW)
- 5 Gbps의 bandwidth를 가지고 45 Gbps까지 오토 스케일링이 가능하다.
- 관리할 SG를 필요로 하지 않는다.

### NAT Gateway with High Availability
- NAT 게이트웨이는 하나의 AZ 내에서는 회복탄력성이 있다. (resilient)
- fault-tolerance를 위해서는 여러 개의 AZ들에 여러 개의 NAT 게이트웨이들을 만들어야한다.
- 단 cross-AZ failover는 필요하지 않다.
- 왜냐하면 AZ가 내려갔다면 NAT가 필요하지 않기 때문이다.
